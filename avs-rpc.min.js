(function(u){"object"===typeof exports&&"undefined"!==typeof module?module.exports=u():"function"===typeof define&&define.amd?define([],u):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).avs=u()})(function(){return function t(q,p,n){function r(h,l){if(!p[h]){if(!q[h]){var k="function"==typeof require&&require;if(!l&&k)return k(h,!0);if(m)return m(h,!0);k=Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",k;}k=p[h]={exports:{}};
q[h][0].call(k.exports,function(c){var a=q[h][1][c];return r(a?a:c)},k,k.exports,t,q,p,n)}return p[h].exports}for(var m="function"==typeof require&&require,l=0;l<n.length;l++)r(n[l]);return r}({1:[function(t,q,p){function n(b,d,e){var f=[],c=[b],k=[b],m=[e?"~":"[Circular]"],p=b,s=1,n;return function(b,g){d&&(g=d.call(this,b,g));""!==b&&(p!==this&&(n=s-a.call(c,this)-1,s-=n,c.splice(s,c.length),f.splice(s-1,f.length),p=this),"object"===typeof g&&g?(s=c.push(p=g),n=a.call(k,g),0>n?(n=k.push(g)-1,e?
(f.push((""+b).replace(v,l)),m[n]="~"+f.join("~")):m[n]=m[0]):g=m[n]):"string"===typeof g&&e&&(g=g.replace(l,h).replace("~",l)));return g}}function r(a){return function(d,e){var f="string"===typeof e;if(f&&"~"===e.charAt(0))return new b(e.slice(1));""===d&&(e=m(e,e,{}));f&&(e=e.replace(c,"~").replace(h,l));return a?a.call(this,d,e):e}}function m(a,d,e){if(d instanceof Array)for(var f=0,c=d.length;f<c;f++)d[f]=m(a,d[f],e);else if(d instanceof b)if(d.length)if(e.hasOwnProperty(d))d=e[d];else{for(var f=
d.split("~"),c=0,h=f.length;c<h;a=a[f[c++].replace(k,"~")]);d=e[d]=a}else d=a;else if(d instanceof Object)for(f in d)d.hasOwnProperty(f)&&(d[f]=m(a,d[f],e));return d}var l="\\x"+("0"+(126).toString(16)).slice(-2),h="\\"+l,v=new RegExp(l,"g"),k=new RegExp(h,"g"),c=new RegExp("(?:^|[^\\\\])"+h),a=[].indexOf||function(a){for(var b=this.length;b--&&this[b]!==a;);return b},b=String;this.stringify=function(a,b,e,f){return JSON.stringify(a,n(a,b,!f),e)};this.parse=function(a,b){return JSON.parse(a,r(b))}},
{}],2:[function(t,q,p){(function(){var n,r,m,l,h=[].slice,q={}.hasOwnProperty,k=function(c,a){function b(){this.constructor=c}for(var g in a)q.call(a,g)&&(c[g]=a[g]);b.prototype=a.prototype;c.prototype=new b;c.__super__=a.prototype;return c};l=t("circular-json");n=function(){return function(c,a,b){this.asynchronous=b;this[a]=function(b){return function(d,e,f){console.log("rpc "+d+": executing local "+a+" - asynchronous: "+b.asynchronous);return c[a].apply(c,h.call(e).concat([f]))}}(this)}}();r=function(){return function(){var c,
a,b,g,d,e,f,k;g=arguments[0];b=2<=arguments.length?h.call(arguments,1):[];c=0;d=(Math.random()+"").substring(2,8);e=function(a){return function(b){return a[b]=function(){var a,e;a=Array.prototype.slice.call(arguments);"function"===typeof a[a.length-1]&&(e=a.pop());if(g)return g._request({method:b,args:a,cb:e,id:""+d+"-"+ ++c})}}}(this);f=0;for(k=b.length;f<k;f++)a=b[f],e(a)}}();p.Rpc=m=function(){function c(){this.locals=[];this.callbacks=[];this._out=function(a){return function(b,g){return a.log("rpc "+
b.id+" error: no rpc out route defined")}}(this)}c.prototype.cbID=0;c.prototype.out=function(a){return this._out=a};c.prototype._request=function(a){var b;a.cb&&"function"===typeof a.cb&&(this.callbacks[b=a.method+(" cb"+this.cbID++)]=a.cb,a.cb=b);b=l.stringify(a);this.log("rpc "+a.id+": out "+b);this._out(a,b);return b};c.prototype._reply=function(a,b){if(a.cb)return this._request({method:a.cb,args:b,id:a.id})};c.prototype._error=function(a,b){if(a.cb)return this._request({method:a.cb,args:b,err:!0,
id:a.id})};c.prototype.process=function(a){var b,g,d,e,f;try{"string"===typeof a?e=l.parse(a):a=l.stringify(e=a);if(e&&e.method){d=this.locals[e.method];this.log("rpc "+e.id+": in  "+a);if(d)return d.asynchronous?d[e.method](e.id,e.args,function(a){return function(b,d){return d?a._error(e,d):a._reply(e,b)}}(this)):this._reply(e,d[e.method](e.id,e.args));if(this.callbacks[e.method])return e.err?g=e.args:f=e.args,this.callbacks[e.method](f,g),delete this.callbacks[e.method];this.log(b="error: method "+
e.method+" is unknown");return this._error(e,b)}this.log(b="rpc error: message is null");this._error({method:"missing"},b)}catch(c){return this.log(b="error in "+e.method+": "+c),this._error(e,b)}};c.prototype._splat=function(){var a;a=1<=arguments.length?h.call(arguments,0):[];return 1===arguments.length&&"string"!==typeof arguments[0]?arguments[0]:a};c.prototype.remote=function(){var a;a=1<=arguments.length?h.call(arguments,0):[];return function(a,g,d){d.prototype=a.prototype;d=new d;a=a.apply(d,
g);return Object(a)===a?a:d}(r,[this].concat(h.call(this._splat.apply(this,a))),function(){})};c.prototype.implement=function(){var a,b;a=arguments[0];b=2<=arguments.length?h.call(arguments,1):[];return this._expose.apply(this,[a,!1].concat(h.call(this._splat.apply(this,b))))};c.prototype.implementAsync=function(){var a,b;a=arguments[0];b=2<=arguments.length?h.call(arguments,1):[];return this._expose.apply(this,[a,!0].concat(h.call(this._splat.apply(this,b))))};c.prototype._expose=function(){var a,
b,g,d,e,f,c;b=arguments[0];a=arguments[1];d=3<=arguments.length?h.call(arguments,2):[];if(!d.length){for(g in b)"function"===typeof b[g]&&"_"!==g.charAt(0)&&d.push(g);this.log("rpc methods found: "+d)}c=[];e=0;for(f=d.length;e<f;e++)g=d[e],b[g]?(this.locals[g]&&this.log("rpc warning: duplicate method "+g+", now asynchronous: "+a),c.push(this.locals[g]=new n(b,g,a))):c.push(this.log("rpc warning: local object has no method "+g));return c};c.prototype.log=function(a){return console.log(128>a.length?
a:a.substring(0,127)+" ...")};return c}();p.wsRpc=function(c){function a(b){a.__super__.constructor.call(this);b&&b.send&&this.out(function(a,d){return b.send(d,function(a){return function(b){if(b)return a.log(b.toString())}}(this))});this["in"](b)}k(a,c);a.prototype["in"]=function(a){if(a)return a.on?a.on("message",function(a){return function(b,e){if(!e.binary)return a.process(b)}}(this)):a.onmessage=function(a){return function(b){if(b.data.length)return a.process(b.data)}}(this)};return a}(m);p.angularRpc=
function(c){function a(b){a.__super__.constructor.call(this);this.out(function(a,d){return b.post("/rpc",a).success(function(a){return function(b){if(b)return a.process(b)}}(this))})}k(a,c);return a}(m);p.xmlHttpRpc=function(c){function a(b){a.__super__.constructor.call(this);this.out(function(a,d){b.open("POST","/rpc",!0);b.setRequestHeader("Content-type","application/json");b.onload(function(a){return function(){return a.process(b.response)}}(this));return b.send(d)})}k(a,c);return a}(m);p.ioRpc=
m=function(c){function a(a,c){this.socket=a;this.tag=null!=c?c:"rpc";this.locals=[];if(this.socket)this.socket.on(this.tag,function(a){return function(b,c){return a.process(b,c)}}(this))}k(a,c);a.prototype._request=function(a){var c;this.log("rpc "+a.id+": out "+this.tag+" "+(c=l.stringify(a)));if(this.socket)return this.socket.emit(this.tag,c,function(){if(a.cb)return a.cb.apply(this,arguments)})};a.prototype.process=function(a,c){var d,e,f;f=l.parse(a);this.log("rpc "+f.id+": in  "+this.tag+" "+
a);if(e=this.locals[f.method])try{return d=f.args||[],d.push(function(a){return function(){return c.apply(a,arguments)}}(this)),e.asynchronous?e[f.method](f.id,d):c(e[f.method](f.id,d))}catch(h){return this.log(d="error in "+f.method+": "+h),c(null,d)}else return this.log(d="error: method "+f.method+" is unknown"),c(null,d)};return a}(m);p.scRpc=function(c){function a(){return a.__super__.constructor.apply(this,arguments)}k(a,c);a.prototype.process=function(a,c){var d,e,f;f=l.parse(a);this.log("rpc "+
f.id+": in  "+this.tag+" "+a);if(e=this.locals[f.method])try{return d=f.args||[],d.push(function(a){return function(){return c.apply(a,arguments)}}(this)),e.asynchronous?e[f.method](f.id,d):c(null,e[f.method](f.id,d))}catch(h){return this.log(d="error in "+f.method+": "+h),c(d)}else return this.log(d="error: method "+f.method+" is unknown"),c(d)};return a}(m)}).call(this)},{"circular-json":1}]},{},[2])(2)});
