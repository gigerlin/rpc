!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var p;"undefined"!=typeof window?p=window:"undefined"!=typeof global?p=global:"undefined"!=typeof self&&(p=self);p.avs=t()}}(function(){return function p(r,q,m){function s(g,l){if(!q[g]){if(!r[g]){var k="function"==typeof require&&require;if(!l&&k)return k(g,!0);if(n)return n(g,!0);k=Error("Cannot find module '"+g+"'");throw k.code="MODULE_NOT_FOUND",
k;}k=q[g]={exports:{}};r[g][0].call(k.exports,function(c){var a=r[g][1][c];return s(a?a:c)},k,k.exports,p,r,q,m)}return q[g].exports}for(var n="function"==typeof require&&require,l=0;l<m.length;l++)s(m[l]);return s}({1:[function(p,r,q){function m(b,d,e){var h=[],c=[b],k=[b],n=[e?"~":"[Circular]"],q=b,p=1,m;return function(b,f){d&&(f=d.call(this,b,f));""!==b&&(q!==this&&(m=p-a.call(c,this)-1,p-=m,c.splice(p,c.length),h.splice(p-1,h.length),q=this),"object"===typeof f&&f?(p=c.push(q=f),m=a.call(k,f),
0>m?(m=k.push(f)-1,e?(h.push((""+b).replace(u,l)),n[m]="~"+h.join("~")):n[m]=n[0]):f=n[m]):"string"===typeof f&&e&&(f=f.replace(l,g).replace("~",l)));return f}}function s(a){return function(d,e){var h="string"===typeof e;if(h&&"~"===e.charAt(0))return new b(e.slice(1));""===d&&(e=n(e,e,{}));h&&(e=e.replace(c,"~").replace(g,l));return a?a.call(this,d,e):e}}function n(a,d,e){if(d instanceof Array)for(var h=0,c=d.length;h<c;h++)d[h]=n(a,d[h],e);else if(d instanceof b)if(d.length)if(e.hasOwnProperty(d))d=
e[d];else{for(var h=d.split("~"),c=0,g=h.length;c<g;a=a[h[c++].replace(k,"~")]);d=e[d]=a}else d=a;else if(d instanceof Object)for(h in d)d.hasOwnProperty(h)&&(d[h]=n(a,d[h],e));return d}var l="\\x"+("0"+(126).toString(16)).slice(-2),g="\\"+l,u=new RegExp(l,"g"),k=new RegExp(g,"g"),c=new RegExp("(?:^|[^\\\\])"+g),a=[].indexOf||function(a){for(var b=this.length;b--&&this[b]!==a;);return b},b=String;this.stringify=function(a,b,e,c){return JSON.stringify(a,m(a,b,!c),e)};this.parse=function(a,b){return JSON.parse(a,
s(b))}},{}],2:[function(p,r,q){(function(){var m,s,n,l,g=[].slice,r={}.hasOwnProperty,k=function(c,a){function b(){this.constructor=c}for(var f in a)r.call(a,f)&&(c[f]=a[f]);b.prototype=a.prototype;c.prototype=new b;c.__super__=a.prototype;return c};l=p("circular-json");m=function(){return function(c,a,b){this.local=c;this.asynchronous=b;this[a]=function(b){return function(d,e,c){var k;console.log("rpc "+d+": local "+a+" - asynchronous: "+b.asynchronous);return(k=b.local)[a].apply(k,g.call(e).concat([c]))}}(this)}}();
s=function(){function c(){var a,b,f,d;a=arguments[0];b=2<=arguments.length?g.call(arguments,1):[];this.rpc=a;this.uid=(Math.random()+"").substring(2,8);f=0;for(d=b.length;f<d;f++)a=b[f],this[a]=new Function("","var arg, args, cb, last, _i, _len; args = []; for (_i = 0, _len = arguments.length; _i < _len; _i++) { args.push(arguments[_i]); } last = arguments[arguments.length - 1]; if (typeof last === 'function') { cb = last; args.pop()} return this.rpc._request({method:'"+a+"', args:args, cb:cb, id:'"+
this.uid+"-'+(++this.count)});")}c.prototype.count=0;return c}();q.Rpc=n=function(){function c(){this.locals=[];this.callbacks=[];this._out=function(a){return function(b,f){return a.log("rpc "+b.id+" error: no rpc out route defined")}}(this)}c.prototype.cbID=0;c.prototype.out=function(a){return this._out=a};c.prototype._request=function(a){var b;a.cb&&"function"===typeof a.cb&&(this.callbacks[b=a.method+(" cb"+this.cbID++)]=a.cb,a.cb=b);b=l.stringify(a);this.log("rpc "+a.id+": out "+b);this._out(a,
b);return b};c.prototype._reply=function(a,b){if(a.cb)return this._request({method:a.cb,args:b,id:a.id})};c.prototype._error=function(a,b){if(a.cb)return this._request({method:a.cb,args:b,err:!0,id:a.id})};c.prototype.process=function(a){var b,f,d,e,c;try{"string"===typeof a?e=l.parse(a):a=l.stringify(e=a);if(e&&e.method){d=this.locals[e.method];this.log("rpc "+e.id+": in  "+a);if(d)return d.asynchronous?d[e.method](e.id,e.args,function(a){return function(b,d){return d?a._error(e,d):a._reply(e,b)}}(this)):
this._reply(e,d[e.method](e.id,e.args));if(this.callbacks[e.method])return e.err?f=e.args:c=e.args,this.callbacks[e.method](c,f),delete this.callbacks[e.method];this.log(b="error: method "+e.method+" is unknown");return this._error(e,b)}this.log(b="rpc error: message is null");this._error({method:"missing"},b)}catch(g){return this.log(b="error in "+e.method+": "+g),this._error(e,b)}};c.prototype._splat=function(){var a;a=1<=arguments.length?g.call(arguments,0):[];return 1===arguments.length&&"string"!==
typeof arguments[0]?arguments[0]:a};c.prototype.remote=function(){var a;a=1<=arguments.length?g.call(arguments,0):[];return function(a,f,d){d.prototype=a.prototype;d=new d;a=a.apply(d,f);return Object(a)===a?a:d}(s,[this].concat(g.call(this._splat.apply(this,a))),function(){})};c.prototype.implement=function(){var a,b;a=arguments[0];b=2<=arguments.length?g.call(arguments,1):[];return this._expose.apply(this,[a,!1].concat(g.call(this._splat.apply(this,b))))};c.prototype.implementAsync=function(){var a,
b;a=arguments[0];b=2<=arguments.length?g.call(arguments,1):[];return this._expose.apply(this,[a,!0].concat(g.call(this._splat.apply(this,b))))};c.prototype._expose=function(){var a,b,f,d,e,c,k;b=arguments[0];a=arguments[1];d=3<=arguments.length?g.call(arguments,2):[];if(!d.length){for(f in b)"function"===typeof b[f]&&"_"!==f.charAt(0)&&d.push(f);this.log("rpc methods found: "+d)}k=[];e=0;for(c=d.length;e<c;e++)f=d[e],b[f]?(this.locals[f]&&this.log("rpc warning: duplicate method "+f+", now asynchronous: "+
a),k.push(this.locals[f]=new m(b,f,a))):k.push(this.log("rpc warning: local object has no method "+f));return k};c.prototype.log=function(a){return console.log(128>a.length?a:a.substring(0,127)+" ...")};return c}();q.wsRpc=function(c){function a(b){a.__super__.constructor.call(this);b&&b.send&&this.out(function(a,d){return b.send(d,function(a){return function(b){if(b)return a.log(b.toString())}}(this))});this["in"](b)}k(a,c);a.prototype["in"]=function(a){if(a)return a.on?a.on("message",function(a){return function(b,
e){if(!e.binary)return a.process(b)}}(this)):a.onmessage=function(a){return function(b){if(b.data.length)return a.process(b.data)}}(this)};return a}(n);q.angularRpc=function(c){function a(b){a.__super__.constructor.call(this);this.out(function(a,d){return b.post("/rpc",a).success(function(a){return function(b){if(b)return a.process(b)}}(this))})}k(a,c);return a}(n);q.xmlHttpRpc=function(c){function a(b){a.__super__.constructor.call(this);this.out(function(a,d){b.open("POST","/rpc",!0);b.setRequestHeader("Content-type",
"application/json");b.onload(function(a){return function(){return a.process(b.response)}}(this));return b.send(d)})}k(a,c);return a}(n);q.ioRpc=function(c){function a(a){this.socket=a;this.locals=[];if(this.socket)this.socket.on("rpc",function(a){return function(b,e){return a.process(b,e)}}(this))}k(a,c);a.prototype._request=function(a){var c,d;console.log("rpc "+a.id+": out "+(d=l.stringify(a)));c=a.cb||function(){};if(this.socket)return this.socket.emit("rpc",d,function(){return c.apply(this,arguments)})};
a.prototype.process=function(a,c){var d,e,h;h=l.parse(a);this.log("rpc "+h.id+": in  "+a);if(e=this.locals[h.method])try{return d=h.args||[],d.push(function(a){return function(){return c.apply(a,arguments)}}(this)),e.asynchronous?e[h.method](h.id,d):c(e[h.method](h.id,d))}catch(g){return c(null,"error in "+h.method+": "+g)}else return c(null,"error: method "+h.method+" is unknown")};return a}(n)}).call(this)},{"circular-json":1}]},{},[2])(2)});
