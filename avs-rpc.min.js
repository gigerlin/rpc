!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var p;"undefined"!=typeof window?p=window:"undefined"!=typeof global?p=global:"undefined"!=typeof self&&(p=self);p.avs=t()}}(function(){return function p(r,q,m){function s(h,l){if(!q[h]){if(!r[h]){var k="function"==typeof require&&require;if(!l&&k)return k(h,!0);if(n)return n(h,!0);k=Error("Cannot find module '"+h+"'");throw k.code="MODULE_NOT_FOUND",
k;}k=q[h]={exports:{}};r[h][0].call(k.exports,function(c){var a=r[h][1][c];return s(a?a:c)},k,k.exports,p,r,q,m)}return q[h].exports}for(var n="function"==typeof require&&require,l=0;l<m.length;l++)s(m[l]);return s}({1:[function(p,r,q){function m(b,d,e){var g=[],c=[b],k=[b],n=[e?"~":"[Circular]"],q=b,p=1,m;return function(b,f){d&&(f=d.call(this,b,f));""!==b&&(q!==this&&(m=p-a.call(c,this)-1,p-=m,c.splice(p,c.length),g.splice(p-1,g.length),q=this),"object"===typeof f&&f?(p=c.push(q=f),m=a.call(k,f),
0>m?(m=k.push(f)-1,e?(g.push((""+b).replace(u,l)),n[m]="~"+g.join("~")):n[m]=n[0]):f=n[m]):"string"===typeof f&&e&&(f=f.replace(l,h).replace("~",l)));return f}}function s(a){return function(d,e){var g="string"===typeof e;if(g&&"~"===e.charAt(0))return new b(e.slice(1));""===d&&(e=n(e,e,{}));g&&(e=e.replace(c,"~").replace(h,l));return a?a.call(this,d,e):e}}function n(a,d,e){if(d instanceof Array)for(var g=0,c=d.length;g<c;g++)d[g]=n(a,d[g],e);else if(d instanceof b)if(d.length)if(e.hasOwnProperty(d))d=
e[d];else{for(var g=d.split("~"),c=0,h=g.length;c<h;a=a[g[c++].replace(k,"~")]);d=e[d]=a}else d=a;else if(d instanceof Object)for(g in d)d.hasOwnProperty(g)&&(d[g]=n(a,d[g],e));return d}var l="\\x"+("0"+(126).toString(16)).slice(-2),h="\\"+l,u=new RegExp(l,"g"),k=new RegExp(h,"g"),c=new RegExp("(?:^|[^\\\\])"+h),a=[].indexOf||function(a){for(var b=this.length;b--&&this[b]!==a;);return b},b=String;this.stringify=function(a,b,e,g){return JSON.stringify(a,m(a,b,!g),e)};this.parse=function(a,b){return JSON.parse(a,
s(b))}},{}],2:[function(p,r,q){(function(){var m,s,n,l,h=[].slice,r={}.hasOwnProperty,k=function(c,a){function b(){this.constructor=c}for(var f in a)r.call(a,f)&&(c[f]=a[f]);b.prototype=a.prototype;c.prototype=new b;c.__super__=a.prototype;return c};l=p("circular-json");m=function(){return function(c,a,b){this.local=c;this.asynchronous=b;this[a]=function(b){return function(d,e,g){var c;console.log("rpc "+d+": executing local "+a+" - asynchronous: "+b.asynchronous);return(c=b.local)[a].apply(c,h.call(e).concat([g]))}}(this)}}();
s=function(){function c(){var a,b,f,d;a=arguments[0];b=2<=arguments.length?h.call(arguments,1):[];this.rpc=a;this.uid=(Math.random()+"").substring(2,8);f=0;for(d=b.length;f<d;f++)a=b[f],this[a]=new Function("","var cb, args = Array.prototype.slice.call(arguments); if (typeof args[args.length-1] === 'function') cb = args.pop(); this.rpc._request({method:'"+a+"', args:args, cb:cb, id:'"+this.uid+"-'+(++this.count)});")}c.prototype.count=0;return c}();q.Rpc=n=function(){function c(){this.locals=[];this.callbacks=
[];this._out=function(a){return function(b,f){return a.log("rpc "+b.id+" error: no rpc out route defined")}}(this)}c.prototype.cbID=0;c.prototype.out=function(a){return this._out=a};c.prototype._request=function(a){var b;a.cb&&"function"===typeof a.cb&&(this.callbacks[b=a.method+(" cb"+this.cbID++)]=a.cb,a.cb=b);b=l.stringify(a);this.log("rpc "+a.id+": out "+b);this._out(a,b);return b};c.prototype._reply=function(a,b){if(a.cb)return this._request({method:a.cb,args:b,id:a.id})};c.prototype._error=
function(a,b){if(a.cb)return this._request({method:a.cb,args:b,err:!0,id:a.id})};c.prototype.process=function(a){var b,f,d,e,c;try{"string"===typeof a?e=l.parse(a):a=l.stringify(e=a);if(e&&e.method){d=this.locals[e.method];this.log("rpc "+e.id+": in  "+a);if(d)return d.asynchronous?d[e.method](e.id,e.args,function(a){return function(b,d){return d?a._error(e,d):a._reply(e,b)}}(this)):this._reply(e,d[e.method](e.id,e.args));if(this.callbacks[e.method])return e.err?f=e.args:c=e.args,this.callbacks[e.method](c,
f),delete this.callbacks[e.method];this.log(b="error: method "+e.method+" is unknown");return this._error(e,b)}this.log(b="rpc error: message is null");this._error({method:"missing"},b)}catch(h){return this.log(b="error in "+e.method+": "+h),this._error(e,b)}};c.prototype._splat=function(){var a;a=1<=arguments.length?h.call(arguments,0):[];return 1===arguments.length&&"string"!==typeof arguments[0]?arguments[0]:a};c.prototype.remote=function(){var a;a=1<=arguments.length?h.call(arguments,0):[];return function(a,
f,d){d.prototype=a.prototype;d=new d;a=a.apply(d,f);return Object(a)===a?a:d}(s,[this].concat(h.call(this._splat.apply(this,a))),function(){})};c.prototype.implement=function(){var a,b;a=arguments[0];b=2<=arguments.length?h.call(arguments,1):[];return this._expose.apply(this,[a,!1].concat(h.call(this._splat.apply(this,b))))};c.prototype.implementAsync=function(){var a,b;a=arguments[0];b=2<=arguments.length?h.call(arguments,1):[];return this._expose.apply(this,[a,!0].concat(h.call(this._splat.apply(this,
b))))};c.prototype._expose=function(){var a,b,f,d,e,c,k;b=arguments[0];a=arguments[1];d=3<=arguments.length?h.call(arguments,2):[];if(!d.length){for(f in b)"function"===typeof b[f]&&"_"!==f.charAt(0)&&d.push(f);this.log("rpc methods found: "+d)}k=[];e=0;for(c=d.length;e<c;e++)f=d[e],b[f]?(this.locals[f]&&this.log("rpc warning: duplicate method "+f+", now asynchronous: "+a),k.push(this.locals[f]=new m(b,f,a))):k.push(this.log("rpc warning: local object has no method "+f));return k};c.prototype.log=
function(a){return console.log(128>a.length?a:a.substring(0,127)+" ...")};return c}();q.wsRpc=function(c){function a(b){a.__super__.constructor.call(this);b&&b.send&&this.out(function(a,d){return b.send(d,function(a){return function(b){if(b)return a.log(b.toString())}}(this))});this["in"](b)}k(a,c);a.prototype["in"]=function(a){if(a)return a.on?a.on("message",function(a){return function(b,e){if(!e.binary)return a.process(b)}}(this)):a.onmessage=function(a){return function(b){if(b.data.length)return a.process(b.data)}}(this)};
return a}(n);q.angularRpc=function(c){function a(b){a.__super__.constructor.call(this);this.out(function(a,d){return b.post("/rpc",a).success(function(a){return function(b){if(b)return a.process(b)}}(this))})}k(a,c);return a}(n);q.xmlHttpRpc=function(c){function a(b){a.__super__.constructor.call(this);this.out(function(a,d){b.open("POST","/rpc",!0);b.setRequestHeader("Content-type","application/json");b.onload(function(a){return function(){return a.process(b.response)}}(this));return b.send(d)})}
k(a,c);return a}(n);q.ioRpc=function(c){function a(a,c){this.socket=a;this.tag=null!=c?c:"rpc";this.locals=[];if(this.socket)this.socket.on(this.tag,function(a){return function(b,c){return a.process(b,c)}}(this))}k(a,c);a.prototype._request=function(a){var c,d;this.log("rpc "+a.id+": out "+this.tag+" "+(d=l.stringify(a)));c=a.cb||function(){};if(this.socket)return this.socket.emit(this.tag,d,function(){return c.apply(this,arguments)})};a.prototype.process=function(a,c){var d,e,g;g=l.parse(a);this.log("rpc "+
g.id+": in  "+this.tag+" "+a);if(e=this.locals[g.method])try{return d=g.args||[],d.push(function(a){return function(){return c.apply(a,arguments)}}(this)),e.asynchronous?e[g.method](g.id,d):c(e[g.method](g.id,d))}catch(h){return c(null,"error in "+g.method+": "+h)}else return c(null,"error: method "+g.method+" is unknown")};return a}(n)}).call(this)},{"circular-json":1}]},{},[2])(2)});
