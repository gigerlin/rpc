!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var m;"undefined"!=typeof window?m=window:"undefined"!=typeof global?m=global:"undefined"!=typeof self&&(m=self);m.avs=t()}}(function(){return function m(q,p,g){function r(f,l){if(!p[f]){if(!q[f]){var h="function"==typeof require&&require;if(!l&&h)return h(f,!0);if(k)return k(f,!0);h=Error("Cannot find module '"+f+"'");throw h.code="MODULE_NOT_FOUND",
h;}h=p[f]={exports:{}};q[f][0].call(h.exports,function(b){var a=q[f][1][b];return r(a?a:b)},h,h.exports,m,q,p,g)}return p[f].exports}for(var k="function"==typeof require&&require,l=0;l<g.length;l++)r(g[l]);return r}({1:[function(m,q,p){function g(c,e,d){var b=[],s=[c],h=[c],k=[d?"~":"[Circular]"],p=c,m=1,g;return function(c,n){e&&(n=e.call(this,c,n));""!==c&&(p!==this&&(g=m-a.call(s,this)-1,m-=g,s.splice(m,s.length),b.splice(m-1,b.length),p=this),"object"===typeof n&&n?(m=s.push(p=n),g=a.call(h,n),
0>g?(g=h.push(n)-1,d?(b.push((""+c).replace(v,l)),k[g]="~"+b.join("~")):k[g]=k[0]):n=k[g]):"string"===typeof n&&d&&(n=n.replace(l,f).replace("~",l)));return n}}function r(a){return function(e,d){var u="string"===typeof d;if(u&&"~"===d.charAt(0))return new c(d.slice(1));""===e&&(d=k(d,d,{}));u&&(d=d.replace(b,"~").replace(f,l));return a?a.call(this,e,d):d}}function k(a,e,d){if(e instanceof Array)for(var b=0,f=e.length;b<f;b++)e[b]=k(a,e[b],d);else if(e instanceof c)if(e.length)if(d.hasOwnProperty(e))e=
d[e];else{for(var b=e.split("~"),f=0,g=b.length;f<g;a=a[b[f++].replace(h,"~")]);e=d[e]=a}else e=a;else if(e instanceof Object)for(b in e)e.hasOwnProperty(b)&&(e[b]=k(a,e[b],d));return e}var l="\\x"+("0"+(126).toString(16)).slice(-2),f="\\"+l,v=new RegExp(l,"g"),h=new RegExp(f,"g"),b=new RegExp("(?:^|[^\\\\])"+f),a=[].indexOf||function(a){for(var c=this.length;c--&&this[c]!==a;);return c},c=String;this.stringify=function(a,c,d,b){return JSON.stringify(a,g(a,c,!b),d)};this.parse=function(a,c){return JSON.parse(a,
r(c))}},{}],2:[function(m,q,p){(function(){var g,r,k,l,f=[].slice,q={}.hasOwnProperty,h=function(b,a){function c(){this.constructor=b}for(var n in a)q.call(a,n)&&(b[n]=a[n]);c.prototype=a.prototype;b.prototype=new c;b.__super__=a.prototype;return b};l=m("circular-json");g=function(){return function(b,a,c){this.local=b;this.asynchronous=c;this[a]=function(c){return function(e,d,b){var g;console.log("rpc "+e+": local "+a+" - asynchronous: "+c.asynchronous);return(g=c.local)[a].apply(g,f.call(d).concat([b]))}}(this)}}();
r=function(){function b(){var a,c,b,e;a=arguments[0];c=2<=arguments.length?f.call(arguments,1):[];this.rpc=a;this.uid=(Math.random()+"").substring(2,8);b=0;for(e=c.length;b<e;b++)a=c[b],this[a]=new Function("","var arg, args, cb, last, _i, _len; args = []; for (_i = 0, _len = arguments.length; _i < _len; _i++) { args.push(arguments[_i]); } last = arguments[arguments.length - 1]; if (typeof last === 'function') { cb = last; args.pop()} return this.rpc._request({method:'"+a+"', args:args, cb:cb, id:'"+
this.uid+"-'+(++this.count)});")}b.prototype.count=0;return b}();p.Rpc=k=function(){function b(){this.locals=[];this.callbacks=[];this._out=function(a){return function(c,b){return a.log("rpc "+c.id+" error: no rpc out route defined")}}(this)}b.prototype.cbID=0;b.prototype.out=function(a){return this._out=a};b.prototype._request=function(a){var c;a.cb&&"function"===typeof a.cb&&(this.callbacks[c=a.method+(" cb"+this.cbID++)]=a.cb,a.cb=c);c=l.stringify(a);this.log("rpc "+a.id+": out "+c);this._out(a,
c);return c};b.prototype._reply=function(a,c){if(a.cb)return this._request({method:a.cb,args:c,id:a.id})};b.prototype._error=function(a,c){if(a.cb)return this._request({method:a.cb,args:c,err:!0,id:a.id})};b.prototype.process=function(a){var c,b,e,d,f;try{"string"===typeof a?d=l.parse(a):a=l.stringify(d=a);if(d&&d.method){e=this.locals[d.method];this.log("rpc "+d.id+": in  "+a);if(e)return e.asynchronous?e[d.method](d.id,d.args,function(a){return function(c,b){return b?a._error(d,b):a._reply(d,c)}}(this)):
this._reply(d,e[d.method](d.id,d.args));if(this.callbacks[d.method])return d.err?b=d.args:f=d.args,this.callbacks[d.method](f,b),delete this.callbacks[d.method];this.log(c="error: method "+d.method+" is unknown");return this._error(d,c)}this.log(c="rpc error: message is null");this._error({method:"missing"},c)}catch(g){return this.log(c="error in "+d.method+": "+g),this._error(d,c)}};b.prototype._splat=function(){var a;a=1<=arguments.length?f.call(arguments,0):[];return 1===arguments.length&&"string"!==
typeof arguments[0]?arguments[0]:a};b.prototype.remote=function(){var a;a=1<=arguments.length?f.call(arguments,0):[];return function(a,b,e){e.prototype=a.prototype;e=new e;a=a.apply(e,b);return Object(a)===a?a:e}(r,[this].concat(f.call(this._splat.apply(this,a))),function(){})};b.prototype.implement=function(){var a,c;a=arguments[0];c=2<=arguments.length?f.call(arguments,1):[];return this._expose.apply(this,[a,!1].concat(f.call(this._splat.apply(this,c))))};b.prototype.implementAsync=function(){var a,
c;a=arguments[0];c=2<=arguments.length?f.call(arguments,1):[];return this._expose.apply(this,[a,!0].concat(f.call(this._splat.apply(this,c))))};b.prototype._expose=function(){var a,c,b,e,d,h,k;c=arguments[0];a=arguments[1];e=3<=arguments.length?f.call(arguments,2):[];if(!e.length){for(b in c)"function"===typeof c[b]&&"_"!==b.charAt(0)&&e.push(b);this.log("rpc methods found: "+e)}k=[];d=0;for(h=e.length;d<h;d++)b=e[d],c[b]?(this.locals[b]&&this.log("rpc warning: duplicate method "+b+", now asynchronous: "+
a),k.push(this.locals[b]=new g(c,b,a))):k.push(this.log("rpc warning: local object has no method "+b));return k};b.prototype.log=function(a){return console.log(128>a.length?a:a.substring(0,127)+" ...")};return b}();p.wsRpc=function(b){function a(c){a.__super__.constructor.call(this);c&&c.send&&this.out(function(a,b){return c.send(b,function(a){return function(b){if(b)return a.log(b.toString())}}(this))});this["in"](c)}h(a,b);a.prototype["in"]=function(a){if(a)return a.on?a.on("message",function(a){return function(b,
c){if(!c.binary)return a.process(b)}}(this)):a.onmessage=function(a){return function(b){if(b.data.length)return a.process(b.data)}}(this)};return a}(k);p.angularRpc=function(b){function a(b){a.__super__.constructor.call(this);this.out(function(a,e){return b.post("/rpc",a).success(function(a){return function(b){if(b)return a.process(b)}}(this))})}h(a,b);return a}(k);p.xmlHttpRpc=function(b){function a(b){a.__super__.constructor.call(this);this.out(function(a,e){b.open("POST","/rpc",!0);b.setRequestHeader("Content-type",
"application/json");b.onload(function(a){return function(){return a.process(b.response)}}(this));return b.send(e)})}h(a,b);return a}(k);p.ioRpc=function(b){function a(b){a.__super__.constructor.call(this);b&&(this.out(function(a,e){return b.emit("rpc",a)}),b.on("rpc",function(a){return function(b){return a.process(b)}}(this)))}h(a,b);return a}(k)}).call(this)},{"circular-json":1}]},{},[2])(2)});
